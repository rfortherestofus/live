---
knit: pagedown::chrome_print
output:
  pagedown::html_paged:
    self_contained: TRUE
    number_sections: FALSE
    fig_caption: TRUE
    css: ["css/simple-report-style.css", "css/simple-report-page.css", "css/simple-report-default.css"]
paged-footnotes: TRUE
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      error = FALSE,
                      fig.topcaption = TRUE,
                      fig.cap = TRUE,
                      dpi = 150)
library(tidyverse)
library(flextable)
library(knitr)
library(omni)
library(scales)
library(santoku)
```



```{r results='asis'}
text <- tibble(
  year = seq(2000, 2020, 1),
  long_text = "Laborum proident sit anim duis culpa elit est aliquip culpa aliquip."
)
```

```{r results='asis'}
multipage_table <- function(df) {
  
  add_table_numbers <- function(df, max_table_height = 4) {
    
    table <- df %>% 
      flextable()
    
    table_dimensions <- table %>%
      dim() 
    
    table_row_heights <- table_dimensions$heights %>%
      as_tibble() %>% 
      # Remove header
      slice(-1) %>% 
      set_names("row_height") %>%
      mutate(row_id = row_number()) %>%
      mutate(cumulative_height = cumsum(row_height)) %>%
      mutate(total_height = max(cumulative_height)) %>% 
      mutate(table_number = kiru(cumulative_height,
                                 breaks = seq(0, max(.$total_height), max_table_height))) %>% 
      mutate(table_number = as.numeric(table_number)) 
    
    text_with_table_number <- df %>% 
      bind_cols(table_row_heights) %>% 
      select(year, long_text, table_number)
    
    text_with_table_number
    
  }
  
  text_with_table_numbers <- add_table_numbers(text)
  
  tables <- text_with_table_numbers %>% 
    distinct(table_number) %>% 
      pull(table_number)
  
  display_single_table <- function(table_number_to_filter) {
    
    table_to_print <- text_with_table_numbers %>% 
      filter(table_number == table_number_to_filter) %>% 
      select(-table_number) %>% 
      flextable()
    
    flextable_to_rmd(table_to_print)
    
    cat("\\newpage")
    
  }
  
  walk(tables, display_single_table)
  
}
```



\newpage

```{r results='asis'}
multipage_table(text)
```




